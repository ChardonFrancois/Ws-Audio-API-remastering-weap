<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="./display.css" />
    <link rel="stylesheet" href="./container.css" />

    <!-- jQuery -->
    <link
      rel="stylesheet"
      href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"
    />
    <link rel="stylesheet" href="/resources/demos/style.css" />
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script>
      $(function () {
        $('#datepicker').datepicker()
      })
    </script>

    <!-- bootstrap-->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <!-- select picker -->
    <select id="lang" onchange="window.changeLang()">
      <option value="fr" selected>French</option>
      <option value="es">Spanish</option>
    </select>

    <button class="open-calendar">Open calendar</button>
    <button class="close-calendar">Close calendar</button>
    <!-- btn start stop -->
    <!-- <button id="btnGiveCommand">Change Language</button> -->
    <button class="start" onclick="startContext();streamer.start()">
      START
    </button>
    <button class="stop" onclick="streamer.stop()">STOP</button><br />

    <!--google shearch-->

    <!-- Calendar-->
    <p class="input-calendar">
      Calendrier R.D.V:
      <input type="text" id="datepicker" />
    </p>

    <div class="container">
      <form
        action="https://www.google.com/search"
        method="GET"
        id="search-form"
      >
        <input
          type="text"
          name="q"
          placeholder="Search google..."
          autocomplete="off"
          autofocus
        />
      </form>
    </div>

    <!-- alert message set language -->
    <span id="message"></span>
    <!-- la div ou va se retrouver tout les messages -->
    <div class="output container"></div>
  </body>

  <script
    src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"
    integrity="sha384-eMNCOe7tC1doHpGoWe/6oMVemdAVTMs2xqW4mwXrXsW0L84Iytr2wi5v2QjrP/xp"
    crossorigin="anonymous"
  ></script>
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.min.js"
    integrity="sha384-cn7l7gDp0eyniUwwAZgrzD06kc/tftFf19TOAs2zVinnD/C7E91j9yyk5//jjpt/"
    crossorigin="anonymous"
  ></script>
  <!-- ---------------    -->
  <script src="../src/libopus.js"></script>
  <script src="../src/opus.js"></script>
  <script src="../src/xaudio.js"></script>
  <script src="../src/ws-audio-api.js"></script>
  <script src="./server/index.js"></script>
  <script src="./server/search.js"></script>

  <script>
    function startContext() {
      const audioContext = new (window.AudioContext ||
        window.webkitAudioContext)()
      window.audioContext = audioContext

      //Initialize WebKit Audio:
      ;(function () {
        if (!launchedContext) {
          try {
            audioContextHandle = new AudioContext() //Create a system audio context.
          } catch (error) {
            try {
              audioContextHandle = new AudioContext() //Create a system audio context.
            } catch (error) {
              return
            }
          }
          try {
            audioSource = audioContextHandle.createBufferSource() //We need to create a false input to get the chain started.
            audioSource.loop = false //Keep this alive forever (Event handler will know when to ouput.)
            XAudioJSSampleRate = webAudioActualSampleRate =
              audioContextHandle.sampleRate
            audioSource.buffer = audioContextHandle.createBuffer(
              1,
              1,
              webAudioActualSampleRate
            ) //Create a zero'd input buffer for the input to be valid.
            audioNode = audioContextHandle.createJavaScriptNode(
              samplesPerCallback,
              1,
              2
            ) //Create 2 outputs and ignore the input buffer (Just copy buffer 1 over if mono)
            audioNode.onaudioprocess = audioOutputEvent //Connect the audio processing event to a handling function so we can manipulate output
            audioSource.connect(audioNode) //Send and chain the input to the audio manipulation.
            audioNode.connect(audioContextHandle.destination) //Send and chain the output of the audio manipulation to the system audio output.
            audioSource.noteOn(0) //Start the loop!
          } catch (error) {
            return
          }
          launchedContext = true
        }
      })()

      let defaultConfig = {
        codec: {
          sampleRate: 24000,
          channels: 1,
          app: 2048,
          frameDuration: 20,
          bufferSize: 4096,
        },
        server: {
          host: 'ws://localhost:8080',
        },
      }

      window.streamer = new WSAudioAPI.Streamer(defaultConfig)
    }

    //const  hidden btn start and stop + cont calendar
    const start = document.querySelector('.start')
    const stop = document.querySelector('.stop')
    const openCalendar = document.querySelector('.open-calendar')
    const closeCalendar = document.querySelector('.close-calendar')
    const hiddenCalendar = document.querySelector('.input-calendar')

    stop.classList.add('hidden')

    start.addEventListener('click', () => {
      start.classList.add('hidden')

      stop.classList.remove('hidden')
    })

    stop.addEventListener('click', () => {
      stop.classList.add('hidden')
      start.classList.remove('hidden')
    })

    // hidden btn and calendar
    hiddenCalendar.classList.add('hidden')
    closeCalendar.classList.add('hidden')

    openCalendar.addEventListener('click', () => {
      openCalendar.classList.add('hidden')
      hiddenCalendar.classList.remove('hidden')
      closeCalendar.classList.remove('hidden')
    })

    closeCalendar.addEventListener('click', () => {
      closeCalendar.classList.add('hidden')
      hiddenCalendar.classList.add('hidden')
      openCalendar.classList.remove('hidden')
    })
  </script>
</html>
